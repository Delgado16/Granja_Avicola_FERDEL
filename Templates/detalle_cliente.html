{% extends "layout.html" %}

{% block main %}
<style>
    :root {
        --primary-color: #3498db;
        --success-color: #2ecc71;
        --warning-color: #f39c12;
        --danger-color: #e74c3c;
        --info-color: #6dd5fa;
        --light-gray: #f8f9fa;
        --border-radius: 8px;
        --box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .card {
        border: none;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        margin-bottom: 20px;
        background: white;
        transition: transform 0.2s ease;
    }
    
    .card:hover {
        transform: translateY(-2px);
    }
    
    .card-header {
        background-color: var(--light-gray);
        border-bottom: 1px solid rgba(0,0,0,0.05);
        padding: 15px 20px;
        border-radius: var(--border-radius) var(--border-radius) 0 0;
    }
    
    .card-title {
        font-weight: 600;
        color: #2c3e50;
        margin: 0;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
    }
    
    .card-title i {
        margin-right: 10px;
        color: var(--primary-color);
    }
    
    .card-body {
        padding: 20px;
    }
    
    .card-footer {
        background-color: var(--light-gray);
        border-top: 1px solid rgba(0,0,0,0.05);
        padding: 15px 20px;
        border-radius: 0 0 var(--border-radius) var(--border-radius);
    }
    
    /* Colores para diferentes secciones */
    .customer-card .card-header {
        background-color: var(--primary-color);
    }
    
    .customer-card .card-title,
    .customer-card .card-title i {
        color: white;
    }
    
    .stats-card .card-title i {
        color: var(--info-color);
    }
    
    .debts-card .card-title i {
        color: var(--danger-color);
    }
    
    .purchases-card .card-title i {
        color: var(--success-color);
    }
    
    .products-card .card-title i {
        color: var(--warning-color);
    }
    
    .payments-card .card-title i {
        color: #95a5a6;
    }
    
    /* Botones simplificados */
    .btn {
        border-radius: var(--border-radius);
        padding: 8px 16px;
        font-weight: 500;
        border: none;
        transition: all 0.2s;
    }
    
    .btn:hover {
        opacity: 0.9;
    }
    
    .btn-primary {
        background-color: var(--primary-color);
    }
    
    .btn-success {
        background-color: var(--success-color);
    }
    
    .btn-info {
        background-color: var(--info-color);
    }
    
    .btn-warning {
        background-color: var(--warning-color);
    }
    
    /* Tablas simplificadas */
    .table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .table th {
        text-align: left;
        padding: 12px 15px;
        background-color: var(--light-gray);
        font-weight: 500;
    }
    
    .table td {
        padding: 12px 15px;
        border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    
    .table tr:last-child td {
        border-bottom: none;
    }
    
    /* Badges simplificados */
    .badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
    }
    
    .badge-success {
        background-color: var(--success-color);
        color: white;
    }
    
    .badge-warning {
        background-color: var(--warning-color);
        color: white;
    }
    
    .badge-danger {
        background-color: var(--danger-color);
        color: white;
    }
    
    /* Textos destacados */
    .highlight {
        font-weight: 500;
        color: #2c3e50;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .card-body {
            padding: 15px;
        }
        
        .table th, 
        .table td {
            padding: 8px 10px;
        }
    }
</style>

<div class="container-fluid">
    <!-- Encabezado del cliente -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card customer-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-user"></i> {{ cliente.Nombre }}
                        <span class="badge badge-light float-right">ID: {{ cliente.ID_Cliente }}</span>
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong><i class="fas fa-id-card"></i> RUC/Cedula:</strong> <span class="highlight">{{ cliente.RUC_CEDULA if cliente.RUC_CEDULA else 'No registrado' }}</span></p>
                            <p><strong><i class="fas fa-phone"></i> Teléfono:</strong> <span class="highlight">{{ cliente.Telefono if cliente.Telefono else 'No registrado' }}</span></p>
                            <p><strong><i class="fas fa-map-marker-alt"></i> Dirección:</strong> <span class="highlight">{{ cliente.Direccion if cliente.Direccion else 'No registrada' }}</span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong><i class="fas fa-file-invoice"></i> Total pendiente:</strong> <span class="highlight">{{ cliente.total_pendiente }}</span></p>
                            <p><strong><i class="fas fa-file-invoice"></i> Facturas pendientes:</strong> <span class="highlight">{{ cliente.facturas_pendientes }}</span></p>
                            <p><strong><i class="fas fa-file-alt"></i> Total facturas:</strong> <span class="highlight">{{ cliente.total_facturas }}</span></p>
                            <p><strong><i class="fas fa-calendar-check"></i> Última compra:</strong> <span class="highlight">{{ cliente.ultima_compra if cliente.ultima_compra else 'Sin registros' }}</span></p>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-center">
                    <a href="{{ url_for('editar_cliente', id=cliente.ID_Cliente) }}" class="btn btn-warning">
                        <i class="fas fa-edit"></i> Editar
                    </a>
                    <a href="{{ url_for('ventas') }}?cliente_id={{ cliente.ID_Cliente }}&cliente_nombre={{ cliente.Nombre|urlencode }}" 
                       class="btn btn-success">
                        <i class="fas fa-file-invoice-dollar"></i> Nueva Factura
                    </a>
                    <a href="{{ url_for('cobros') }}?cliente_id={{ cliente.ID_Cliente }}" class="btn btn-info">
                        <i class="fas fa-money-bill-wave"></i> Registrar Pago
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Resumen financiero -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card stats-card">
                <div class="card-header">
                    <h4 class="card-title"><i class="fas fa-chart-line"></i> Estadísticas de Compras</h4>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3 border-right py-3">
                            <h4>{{ estadisticas.monto_total }}</h4>
                            <p class="text-muted">Total comprado</p>
                        </div>
                        <div class="col-md-3 border-right py-3">
                            <h4>{{ estadisticas.total_compras }}</h4>
                            <p class="text-muted">Compras realizadas</p>
                        </div>
                        <div class="col-md-3 border-right py-3">
                            <h4>{{ estadisticas.promedio_compra }}</h4>
                            <p class="text-muted">Promedio por compra</p>
                        </div>
                        <div class="col-md-3 py-3">
                            <h4>{{ estadisticas.primera_compra }}</h4>
                            <p class="text-muted">Primera compra</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cuentas por cobrar -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card debts-card">
                <div class="card-header">
                    <h4 class="card-title"><i class="fas fa-file-invoice-dollar"></i> Cuentas por Cobrar</h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Documento</th>
                                    <th>Fecha</th>
                                    <th>Vencimiento</th>
                                    <th>Monto</th>
                                    <th>Abono</th>
                                    <th>Saldo</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for cuenta in cuentas_por_cobrar %}
                                <tr>
                                    <td>{{ cuenta.Documento }}</td>
                                    <td>{{ cuenta.Fecha }}</td>
                                    <td>
                                        {{ cuenta.Vencimiento if cuenta.Vencimiento else '-' }}
                                        {% if cuenta.dias_vencimiento %}
                                        <br><small>{{ cuenta.dias_vencimiento }}</small>
                                        {% endif %}
                                    </td>
                                    <td>{{ cuenta.Monto_Original }}</td>
                                    <td>{{ cuenta.Total_Abonado }}</td>
                                    <td>{{ cuenta.Saldo_Pendiente }}</td>
                                    <td>
                                        <span class="badge badge-{{ 'success' if cuenta.Estado == 'Pagada' else 'danger' if cuenta.Estado == 'Vencida' else 'warning' }}">
                                            {{ cuenta.Estado }}
                                        </span>
                                    </td>
                                    <td>
                                        {% if cuenta.Saldo_Pendiente != 'C$0.00' %}
                                        <a href="{{ url_for('cobros') }}?cliente_id={{ cliente.ID_Cliente }}&documento={{ cuenta.Num_Documento }}" 
                                           class="btn btn-sm btn-success">
                                            <i class="fas fa-money-bill-wave">Abonos
                                            </i>
                                        </a>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% if cuenta.Pagos_Realizados and cuenta.Pagos_Realizados != 'Sin pagos' %}
                                <tr>
                                    <td colspan="7" class="small text-muted">
                                        <strong>Pagos:</strong> {{ cuenta.Pagos_Realizados }}
                                    </td>
                                </tr>
                                {% endif %}
                                {% else %}
                                <tr>
                                    <td colspan="7" class="text-center py-4">
                                        <i class="fas fa-check-circle text-success"></i>
                                        No hay cuentas pendientes
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Historial de compras y productos frecuentes -->
    <div class="row mb-4">
        <!-- Historial de compras -->
        <div class="col-md-6">
            <div class="card h-100 purchases-card">
                <div class="card-header">
                    <h4 class="card-title"><i class="fas fa-shopping-cart"></i> Últimas Compras</h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for compra in historial_compras %}
                                <tr>
                                    <td>{{ compra.Fecha }}</td>
                                    <td>
                                        {{ compra.Documento }}
                                        <br>
                                        <span class="badge badge-{{ 'warning' if compra.Tipo == 1 else 'success' }}">
                                            {% if compra.Tipo == 1 %}Crédito{% else %}Contado{% endif %}
                                        </span>
                                    </td>
                                    <td>{{ compra.Total }}</td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="3" class="text-center py-4">
                                        <i class="fas fa-shopping-cart"></i>
                                        No hay historial
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Productos más comprados -->
        <div class="col-md-6">
            <div class="card h-100 products-card">
                <div class="card-header">
                    <h4 class="card-title"><i class="fas fa-star"></i> Productos Frecuentes</h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Veces</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for producto in productos_frecuentes %}
                                <tr>
                                    <td>
                                        {{ producto.Descripcion }}
                                        <br>
                                        <small class="text-muted">{{ producto.COD_Producto }}</small>
                                    </td>
                                    <td>{{ producto.veces_comprado }}</td>
                                    <td>{{ producto.monto_total }}</td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="3" class="text-center py-4">
                                        <i class="fas fa-box-open"></i>
                                        No hay productos
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Historial de pagos -->
    <div class="row">
        <div class="col-md-12">
            <div class="card payments-card">
                <div class="card-header">
                    <h4 class="card-title"><i class="fas fa-money-check-alt"></i> Últimos Pagos</h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Monto</th>
                                    <th>Método</th>
                                    <th>Documento</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for pago in historial_pagos %}
                                <tr>
                                    <td>{{ pago.Fecha }}</td>
                                    <td>{{ pago.Monto }}</td>
                                    <td>{{ pago.metodo_pago }}</td>
                                    <td>
                                        {{ pago.tipo_documento }} #{{ pago.documento_relacionado }}
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="4" class="text-center py-4">
                                        <i class="fas fa-money-bill-wave"></i>
                                        No hay pagos
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}