{% extends "layout.html" %}
{% block title %}Inicio{% endblock %}

{% block main %}
<div class="container">
    <div class="header">
        <h1><i class="fas fa-chart-pie"></i> Resumen del Negocio</h1>
        <p>Actualizado al {{ today }}</p>
    </div>

    <div class="metrics">
        <div class="card">
            <div class="icon"><i class="fas fa-shopping-bag"></i></div>
            <h3>Ventas Hoy</h3>
            <div class="value">${{ "{:,.2f}".format(total_ventas_hoy) }}</div>
        </div>
        <div class="card">
            <div class="icon"><i class="fas fa-chart-line"></i></div>
            <h3>Ventas Mes</h3>
            <div class="value">${{ "{:,.2f}".format(total_ventas_mes) }}</div>
        </div>
        <div class="card">
            <div class="icon"><i class="fas fa-cart-arrow-down"></i></div>
            <h3>Compras Hoy</h3>
            <div class="value">${{ "{:,.2f}".format(total_compras_hoy) }}</div>
        </div>
        <div class="card">
            <div class="icon"><i class="fas fa-boxes"></i></div>
            <h3>Compras Mes</h3>
            <div class="value">${{ "{:,.2f}".format(total_compras_mes) }}</div>
        </div>
    </div>

    <div class="chart-section">
        <h2>Ventas por Tipo de Producto</h2>
        <canvas id="ventasTipoChart" height="300"></canvas>
    </div>
</div>

<style>
    .container {
        max-width: 980px;
        margin: 0 auto;
        padding: 1rem;
    }

    .header {
        background-color: #3b82f6;
        color: white;
        padding: 1rem 2rem;
        border-radius: 10px;
        margin-bottom: 2rem;
    }

    .header h1 {
        font-size: 1.5rem;
        margin-bottom: 0.2rem;
    }

    .metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .card {
        background-color: white;
        border-radius: 8px;
        padding: 1rem;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        position: relative;
    }

    .icon {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 1.2rem;
        color: #aaa;
    }

    .value {
        font-size: 1.4rem;
        font-weight: bold;
        margin-top: 0.5rem;
    }

    .chart-section {
        background: white;
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .chart-section h2 {
        font-size: 1.2rem;
        margin-bottom: 1rem;
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const tipos = [{% for tipo in ventas_por_tipo %}'{{ tipo.tipo }}',{% endfor %}];
    const totales = [{% for tipo in ventas_por_tipo %}{{ tipo.total }},{% endfor %}];

    const ctx = document.getElementById('ventasTipoChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: tipos,
            datasets: [{
                label: 'Ventas por Tipo ($)',
                data: totales,
                backgroundColor: '#3b82f6'
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
{% endblock %}
